(this["webpackJsonpstocks-view"]=this["webpackJsonpstocks-view"]||[]).push([[0],{239:function(e,t,n){e.exports=n(499)},244:function(e,t,n){},246:function(e,t,n){},263:function(e,t,n){},297:function(e,t,n){},319:function(e,t,n){},342:function(e,t,n){},484:function(e,t,n){},497:function(e,t,n){},499:function(e,t,n){"use strict";n.r(t);var r,a=n(0),c=n.n(a),i=n(7),s=n.n(i),o=(n(244),n(13)),u=n.n(o),l=n(21),f=n(24),d=(n(246),n(54)),v=n(77),p=n(211),k=n.n(p),m=n(508),b=n(502);!function(e){e.GetStocks="stocks/list",e.GetStock="stocks/get",e.GetCandles="symbols/candles"}(r||(r={}));var h=function(){function e(){Object(d.a)(this,e),this.client=void 0,this.client=k.a.create({baseURL:"https://api.tinkoff.ru/trading"})}return Object(v.a)(e,[{key:"getStocks",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={tickers:t,country:"All",orderType:"Desc",sortType:"ByEarnings"},t&&(n.tickers=t),e.next=4,this.requestMethod(r.GetStocks,n);case 4:return a=e.sent,e.abrupt("return",a.values);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchStocks",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,c,i=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:20,a={country:"All",orderType:"Desc",sortType:"ByEarnings",start:0,end:n},t&&(a.filter=t),e.next=5,this.requestMethod(r.GetStocks,a);case 5:return c=e.sent,e.abrupt("return",c.values);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getStock",value:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.requestMethod(r.GetStock,{ticker:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCandles",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Date,a=Object(m.a)(n,1),e.next=4,this.requestMethod(r.GetCandles,{from:Object(b.a)(a),to:Object(b.a)(n),resolution:5,ticker:t});case 4:return c=e.sent,e.abrupt("return",c.candles);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestMethod",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(t,n);case 2:if(r=e.sent,!("code"in(a=r.data.payload))||!("message"in a)){e.next=6;break}throw new Error(a.message);case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),g=n(504);n(263);function E(e){var t=c.a.createElement("div",{className:"title-skeleton"});return c.a.createElement("div",{className:"main-layout"},c.a.createElement(g.a,{className:"header",onBack:e.onBack,title:e.title||t,subTitle:e.subtitle,extra:e.extra}),c.a.createElement("div",{className:"body"},e.children))}var w=function(e){return{type:"SET_STOCKS",stocks:e}},y=n(68),O=n(506),j=n(217),S=n(509),x=n(510),N=(n(297),function(e){var t={USD:"$",RUB:"\u20bd"}[e];return t||e});function C(e){var t=function(e){var t=["stock-earnings"];return 0===e.earnings.relative||(e.earnings.relative>0?t.push("positive"):t.push("negative")),t},n=function(e){var t=e.symbol.logoName.replace(".png","x160.png");return"https://static.tinkoff.ru/brands/traiding/".concat(t)},r=function(n){return e.manage?c.a.createElement("div",{className:"delete-button-container"},c.a.createElement(y.a,{type:"primary",danger:!0,onClick:function(){var t;return null===(t=e.onDelete)||void 0===t?void 0:t.call(e,n)}},"Delete")):c.a.createElement("div",{className:"price-container"},c.a.createElement("div",{className:"stock-price"},function(e){var t=e.price.value.toFixed(2),n=N(e.price.currency);return"".concat(t," ").concat(n)}(n)),c.a.createElement("div",{className:t(n).join(" ")},function(e){if(0!==e.earnings.relative)return e.earnings.relative>0?c.a.createElement(S.a,{className:"stock-earnings-caret"}):c.a.createElement(x.a,{className:"stock-earnings-caret"})}(n),function(e){var t=e.earnings.absolute.value.toFixed(2),n=N(e.earnings.absolute.currency),r=Math.abs(100*e.earnings.relative).toFixed(2);return"".concat(t," ").concat(n," (").concat(r,"%)")}(n)))};return c.a.createElement(O.b,{className:"stocks-list",loading:!e.stocks,dataSource:e.stocks||[],renderItem:function(t){return c.a.createElement(O.b.Item,{className:["item",t.symbol.isin].join(" "),key:t.symbol.isin,onClick:function(){return function(t){var n;null===(n=e.onSelect)||void 0===n||n.call(e,t)}(t)}},c.a.createElement(O.b.Item.Meta,{avatar:c.a.createElement(j.a,{src:n(t)}),title:t.symbol.showName,description:t.symbol.ticker}),c.a.createElement("div",{className:"content"},r(t)))}})}var T=n(12),A=n(40),R=function(e,t){var n=e.stocks?e.stocks:[];return n.find((function(e){return e.symbol.isin===t.stock.symbol.isin}))?e:Object(A.a)({},e,{stocks:[].concat(Object(T.a)(n),[t.stock])})},I=function(e,t){var n=e.stocks?e.stocks:[];return n.find((function(e){return e.symbol.isin===t.stock.symbol.isin}))?Object(A.a)({},e,{stocks:n.filter((function(e){return e!==t.stock}))}):e},D={stocks:void 0},M=function(e,t){if(e.tickers.includes(t.ticker))return e;var n=[].concat(Object(T.a)(e.tickers),[t.ticker]);return localStorage.setItem("tickers",JSON.stringify(n)),Object(A.a)({},e,{tickers:n})},K=function(e,t){if(!e.tickers.includes(t.ticker))return e;var n=e.tickers.filter((function(e){return e!==t.ticker}));return localStorage.setItem("tickers",JSON.stringify(n)),Object(A.a)({},e,{tickers:n})},_={tickers:["V","ADBE","AAPL","INTC","FB","AMD","GOOGL","GOOG","NVDA","MSFT","MA"]},G=n(91),B=n(92),F=Object(G.b)({stocks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_STOCKS":return Object(A.a)({},e,{stocks:t.stocks});case"ADD_STOCK":return R(e,t);case"REMOVE_STOCK":return I(e,t);case"CLEAR_STOCKS":return Object(A.a)({},e,{stocks:void 0});default:return e}},tickers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TICKERS":return localStorage.setItem("tickers",JSON.stringify(t.tickers)),Object(A.a)({},e,{tickers:t.tickers});case"ADD_TICKER":return M(e,t);case"REMOVE_TICKER":return K(e,t);case"CLEAR_TICKERS":return localStorage.setItem("tickers","[]"),Object(A.a)({},e,{tickers:[]});default:return e}}}),W=Object(G.c)(F),L=function(){return[Object(B.c)((function(e){return e})),Object(B.b)()]},P=n(511),J=n(15),U=n(53),q=n(226),V=n.n(q),H=n(108),$=n.n(H);n(319);function z(e){return c.a.createElement($.a,Object.assign({className:"bottom-button"},e),e.children)}var X=new h;function Q(){var e=Object(J.f)(),t=L(),n=Object(f.a)(t,2),r=n[0],i=n[1];Object(a.useEffect)((function(){var e=function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X.getStocks(r.tickers.tickers);case 3:t=e.sent,i(w(t)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.warn(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e();var t=!1;return V()(function(){var n=Object(l.a)(u.a.mark((function n(r,a){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=3;break}return a(),n.abrupt("return");case 3:return n.abrupt("return",e());case 4:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),5e3),function(){t=!0}}),[i,r.tickers.tickers]);return c.a.createElement(E,{title:"Stocks"},c.a.createElement("div",{className:"main-view"},c.a.createElement("div",{className:"stock-list-container"},c.a.createElement(C,{stocks:r.stocks.stocks,onSelect:function(t){e.push("/stock-details/".concat(t.symbol.ticker))}})),c.a.createElement(U.b,{to:"/add-stock"},c.a.createElement(z,{type:"primary",icon:c.a.createElement(P.a,null),block:!0},"Add stock"))))}n(342);var Y=n(228),Z=n.n(Y),ee=n(505),te=n(503),ne=n(512),re=n(513),ae=n(153),ce=n.n(ae),ie=function(e){return{type:"SET_TICKERS",tickers:e}},se=function(e){return{type:"ADD_TICKER",ticker:e}},oe=function(e){return{type:"REMOVE_TICKER",ticker:e}},ue=new h;function le(){var e=Object(J.f)(),t=L(),n=Object(f.a)(t,2),r=n[0],i=n[1],s=Object(J.h)(),o=Object(a.useRef)(),d=Object(a.useState)(),v=Object(f.a)(d,2),p=v[0],k=v[1],m=Object(a.useState)(),b=Object(f.a)(m,2),h=b[0],g=b[1];Object(a.useEffect)((function(){o.current=s.ticker})),Object(a.useEffect)((function(){var e=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.current){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,ue.getStock(t);case 6:n=e.sent,k(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.warn(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.current){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,ue.getCandles(t);case 6:n=e.sent,g(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.warn(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}();e(),t()}),[o]),Object(a.useEffect)((function(){if(h&&p){var e=new Z.a.Chart({id:"chart",pixelRatio:window.devicePixelRatio}),t=h.map((function(e,t){return{index:t,date:e.date,price:e.c}}));e.source(t,{price:{formatter:function(e){return e.toFixed(2)}}}),e.tooltip({showCrosshairs:!0,showItemMarker:!1,background:{radius:2,fill:"#1890FF",padding:[3,5]},nameStyle:{fill:"#fff"},onShow:function(e){var t=e.items;console.log(t),t[0].name=Object(ee.a)(Object(te.a)(t[0].origin.date),"HH:mm MM/dd"),t[0].value="".concat(t[0].value," ").concat(N(p.price.currency))}}),e.area().position("index*price"),e.line().position("index*price"),e.axis("index",!1),e.interaction("pan"),e.guide().tag({position:[1969,1344],withPoint:!1,content:"1,344",limitInPlot:!0,offsetX:5,direct:"cr"}),e.render()}}),[h,p]);var w=function(){ce()({title:"Do you want to delete ".concat((null===p||void 0===p?void 0:p.symbol.showName)||s.ticker,"?"),icon:c.a.createElement(ne.a,null),centered:!0,okButtonProps:{type:"primary",danger:!0},onOk:function(){i(oe(s.ticker)),e.push("/")},onCancel:function(){}})},y=function(){i(se(s.ticker)),e.push("/")};return c.a.createElement(E,{title:null===p||void 0===p?void 0:p.symbol.showName,subtitle:null===p||void 0===p?void 0:p.symbol.ticker},c.a.createElement("div",{className:"stock-details-view"},c.a.createElement("div",{className:"details-container"},h&&p&&c.a.createElement("div",{className:"details"},c.a.createElement("canvas",{className:"chart-canvas",id:"chart"}),c.a.createElement("div",{className:"details-price"},h[h.length-1].c," ",N(p.price.currency)))),r.tickers.tickers.includes(s.ticker)?c.a.createElement(z,{type:"primary",danger:!0,icon:c.a.createElement(re.a,null),block:!0,onClick:w},"Remove"):c.a.createElement(z,{type:"primary",icon:c.a.createElement(P.a,null),block:!0,onClick:y},"Add")))}n(484);var fe=n(507),de=n(514),ve=new h;function pe(){var e=Object(J.f)(),t=Object(a.useState)(),n=Object(f.a)(t,2),r=n[0],i=n[1],s=Object(a.useState)(),o=Object(f.a)(s,2),d=o[0],v=o[1],p=function(e,t){var n=Object(a.useState)(e),r=Object(f.a)(n,2),c=r[0],i=r[1];return Object(a.useEffect)((function(){var n=setTimeout((function(){i(e)}),t);return function(){clearTimeout(n)}}),[e,t]),c}(r,200),k=L();Object(f.a)(k,2)[1];Object(a.useEffect)((function(){return function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ve.searchStocks(p);case 3:t=e.sent,v(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.warn(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}()(),function(){v(void 0)}}),[p]);return c.a.createElement(E,{title:"Add new stock"},c.a.createElement("div",{className:"add-stock-view"},c.a.createElement("div",{className:"search-container"},c.a.createElement(fe.a,{size:"large",placeholder:"Enter stock ticker or name",value:r,onChange:function(e){return i(e.currentTarget.value)},prefix:c.a.createElement(de.a,null)})),c.a.createElement("div",{className:"stocks-list-container"},c.a.createElement(C,{stocks:d,onSelect:function(t){e.push("/stock-details/".concat(t.symbol.ticker))}}))))}var ke=n(232);function me(e){return Object(ke.a)(e,{stiffness:330,damping:22})}me(0),me(.8),me(1),me(1);function be(){return c.a.createElement(U.a,{basename:"/stocks-view-app"},c.a.createElement("div",{className:"stocks-view-app"},c.a.createElement(J.c,null,c.a.createElement(J.a,{exact:!0,path:"/",component:Q}),c.a.createElement(J.a,{path:"/stock-details/:ticker",component:le}),c.a.createElement(J.a,{path:"/add-stock",component:pe}))))}!function(){try{var e=localStorage.getItem("tickers");if(!e)throw new Error;var t=JSON.parse(e);W.dispatch(ie(t))}catch(n){}}();var he=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ge(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(496),n(497);s.a.render(c.a.createElement(B.a,{store:W},c.a.createElement(be,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/stocks-view-app",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/stocks-view-app","/service-worker.js");he?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ge(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):ge(t,e)}))}}({})}},[[239,1,2]]]);
//# sourceMappingURL=main.774acb97.chunk.js.map