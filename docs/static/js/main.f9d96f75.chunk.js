(this["webpackJsonpstocks-view"]=this["webpackJsonpstocks-view"]||[]).push([[0],{340:function(e,t,n){e.exports=n(626)},345:function(e,t,n){},347:function(e,t,n){},364:function(e,t,n){},398:function(e,t,n){},420:function(e,t,n){},443:function(e,t,n){},618:function(e,t,n){},624:function(e,t,n){},626:function(e,t,n){"use strict";n.r(t);var r,a=n(0),c=n.n(a),s=n(6),i=n.n(s),o=(n(345),n(8)),u=n.n(o),l=n(18),f=n(24),m=(n(347),n(65)),p=n(92),v=n(215),d=n.n(v),k=n(628),b=n(637),h=n(629),E=n(337),g=n(638);!function(e){e.GetStocks="stocks/list",e.GetStock="stocks/get",e.GetCandles="symbols/candles"}(r||(r={}));var w=function(){function e(){Object(m.a)(this,e),this.client=void 0,this.pulseClient=void 0,this.client=d.a.create({baseURL:"https://api.tinkoff.ru/trading"}),this.pulseClient=d.a.create({baseURL:"https://api-invest-gw.tinkoff.ru/social/v1"})}return Object(p.a)(e,[{key:"getStocks",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={tickers:t,country:"All",orderType:"Desc",sortType:"ByEarnings"},t&&(n.tickers=t),e.next=4,this.requestMethod(r.GetStocks,n);case 4:return a=e.sent,e.abrupt("return",a.values);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchStocks",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,c,s=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:20,a={country:"All",orderType:"Desc",sortType:"ByEarnings",start:0,end:n},t&&(a.filter=t),e.next=5,this.requestMethod(r.GetStocks,a);case 5:return c=e.sent,e.abrupt("return",c.values);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getStock",value:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.requestMethod(r.GetStock,{ticker:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCandles",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,c,s,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Date,a=Object(k.a)(n),c=a?Object(b.a)(Object(h.a)(n,{weekStartsOn:1}),{hours:22,minutes:15}):n,s=Object(E.a)(c,1),e.next=6,this.requestMethod(r.GetCandles,{from:Object(g.a)(s),to:Object(g.a)(c),resolution:5,ticker:t});case 6:return i=e.sent,e.abrupt("return",i.candles);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPulsePosts",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:50,e.next=3,this.requestPulseMethod("post/instrument/".concat(t),{limit:n});case 3:return r=e.sent,e.abrupt("return",r.items);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPulseComments",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.requestPulseMethod("post/".concat(t,"/comment"),{});case 2:return n=e.sent,e.abrupt("return",n.items);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestMethod",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(t,n);case 2:if(r=e.sent,!("code"in(a=r.data.payload))||!("message"in a)){e.next=6;break}throw new Error(a.message);case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"requestPulseMethod",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pulseClient.get(t,{params:n});case 2:if(r=e.sent,!("code"in(a=r.data.payload))||!("message"in a)){e.next=6;break}throw new Error(a.message);case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),O=n(633);n(364);function y(e){var t=c.a.createElement("div",{className:"title-skeleton"});return c.a.createElement("div",{className:"main-layout"},c.a.createElement(O.a,{className:"header",onBack:e.onBack,title:e.title||t,subTitle:e.subtitle,extra:e.extra}),c.a.createElement("div",{className:"body"},e.children))}var j=function(e){return{type:"SET_STOCKS",stocks:e}},S=n(81),x=n(634),N=n(315),C=n(639),T=n(640),R=(n(398),function(e){var t={USD:"$",RUB:"\u20bd"}[e];return t||e});function A(e){var t=function(e){var t=["stock-earnings"];return 0===e.earnings.relative||(e.earnings.relative>0?t.push("positive"):t.push("negative")),t},n=function(e){var t=e.symbol.logoName.replace(".png","x160.png");return"https://static.tinkoff.ru/brands/traiding/".concat(t)},r=function(n){return e.manage?c.a.createElement("div",{className:"delete-button-container"},c.a.createElement(S.a,{type:"primary",danger:!0,onClick:function(){var t;return null===(t=e.onDelete)||void 0===t?void 0:t.call(e,n)}},"Delete")):c.a.createElement("div",{className:"price-container"},c.a.createElement("div",{className:"stock-price"},function(e){var t=e.price.value.toFixed(2),n=R(e.price.currency);return"".concat(t," ").concat(n)}(n)),c.a.createElement("div",{className:t(n).join(" ")},function(e){if(0!==e.earnings.relative)return e.earnings.relative>0?c.a.createElement(C.a,{className:"stock-earnings-caret"}):c.a.createElement(T.a,{className:"stock-earnings-caret"})}(n),function(e){var t=e.earnings.absolute.value.toFixed(2),n=R(e.earnings.absolute.currency),r=Math.abs(100*e.earnings.relative).toFixed(2);return"".concat(t," ").concat(n," (").concat(r,"%)")}(n)))};return c.a.createElement(x.b,{className:"stocks-list",loading:!e.stocks,dataSource:e.stocks||[],renderItem:function(t){return c.a.createElement(x.b.Item,{className:["item",t.symbol.isin].join(" "),key:t.symbol.isin,onClick:function(){return function(t){var n;null===(n=e.onSelect)||void 0===n||n.call(e,t)}(t)}},c.a.createElement(x.b.Item.Meta,{avatar:c.a.createElement(N.a,{src:n(t)}),title:t.symbol.showName,description:t.symbol.ticker}),c.a.createElement("div",{className:"content"},r(t)))}})}var I=n(13),M=n(43),D=function(e,t){var n=e.stocks?e.stocks:[];return n.find((function(e){return e.symbol.isin===t.stock.symbol.isin}))?e:Object(M.a)({},e,{stocks:[].concat(Object(I.a)(n),[t.stock])})},P=function(e,t){var n=e.stocks?e.stocks:[];return n.find((function(e){return e.symbol.isin===t.stock.symbol.isin}))?Object(M.a)({},e,{stocks:n.filter((function(e){return e!==t.stock}))}):e},_={stocks:void 0},G=function(e,t){if(e.tickers.includes(t.ticker))return e;var n=[].concat(Object(I.a)(e.tickers),[t.ticker]);return localStorage.setItem("tickers",JSON.stringify(n)),Object(M.a)({},e,{tickers:n})},K=function(e,t){if(!e.tickers.includes(t.ticker))return e;var n=e.tickers.filter((function(e){return e!==t.ticker}));return localStorage.setItem("tickers",JSON.stringify(n)),Object(M.a)({},e,{tickers:n})},B={tickers:["V","ADBE","AAPL","INTC","FB","AMD","GOOGL","GOOG","NVDA","MSFT","MA"]},F=n(116),L=n(117),q=Object(F.b)({stocks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_STOCKS":return Object(M.a)({},e,{stocks:t.stocks});case"ADD_STOCK":return D(e,t);case"REMOVE_STOCK":return P(e,t);case"CLEAR_STOCKS":return Object(M.a)({},e,{stocks:void 0});default:return e}},tickers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TICKERS":return localStorage.setItem("tickers",JSON.stringify(t.tickers)),Object(M.a)({},e,{tickers:t.tickers});case"ADD_TICKER":return G(e,t);case"REMOVE_TICKER":return K(e,t);case"CLEAR_TICKERS":return localStorage.setItem("tickers","[]"),Object(M.a)({},e,{tickers:[]});default:return e}}}),W=Object(F.c)(q),U=function(){return[Object(L.c)((function(e){return e})),Object(L.b)()]},J=n(641),V=n(19),$=n(77),z=n(325),H=n.n(z),Y=n(147),Q=n.n(Y);n(420);function X(e){return c.a.createElement(Q.a,Object.assign({className:"bottom-button"},e),e.children)}var Z=new w;function ee(){var e=Object(V.f)(),t=U(),n=Object(f.a)(t,2),r=n[0],s=n[1];Object(a.useEffect)((function(){var e=function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z.getStocks(r.tickers.tickers);case 3:t=e.sent,s(j(t)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.warn(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e();var t=!1;return H()(function(){var n=Object(l.a)(u.a.mark((function n(r,a){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=3;break}return a(),n.abrupt("return");case 3:return n.abrupt("return",e());case 4:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),5e3),function(){t=!0}}),[s,r.tickers.tickers]);return c.a.createElement(y,{title:"Stocks"},c.a.createElement("div",{className:"main-view"},c.a.createElement("div",{className:"stock-list-container"},c.a.createElement(A,{stocks:r.stocks.stocks,onSelect:function(t){e.push("/stock-details/".concat(t.symbol.ticker))}})),c.a.createElement($.b,{to:"/add-stock"},c.a.createElement(X,{type:"primary",icon:c.a.createElement(J.a,null),block:!0},"Add stock"))))}var te=n(17),ne=(n(443),n(327)),re=n.n(ne),ae=n(630),ce=n(635),se=n(632),ie=n(642),oe=n(643),ue=n(214),le=n.n(ue),fe=function(e){return{type:"SET_TICKERS",tickers:e}},me=function(e){return{type:"ADD_TICKER",ticker:e}},pe=function(e){return{type:"REMOVE_TICKER",ticker:e}},ve=n(631),de=n(95),ke=n(322),be=n(333),he=n(644),Ee=n(220),ge=n.n(Ee),we=new w;function Oe(){var e=Object(V.f)(),t=U(),n=Object(f.a)(t,2),r=n[0],s=n[1],i=Object(V.g)(),o=Object(a.createRef)(),m=Object(a.useRef)(),p=Object(a.useState)(),v=Object(f.a)(p,2),d=v[0],k=v[1],b=Object(a.useState)(),h=Object(f.a)(b,2),E=h[0],g=h[1],w=Object(a.useState)(),O=Object(f.a)(w,2),j=O[0],S=O[1],x=Object(a.useState)(),C=Object(f.a)(x,2),T=C[0],A=C[1];Object(a.useEffect)((function(){m.current=i.ticker})),Object(a.useEffect)((function(){var e=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.current){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,we.getStock(t);case 6:n=e.sent,k(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.warn(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.current){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,we.getCandles(t);case 6:n=e.sent,g(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.warn(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),n=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.current){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,we.getPulsePosts(t);case 6:return n=e.sent,e.next=9,Promise.all(n.map((function(e){return we.getPulseComments(e.id)})));case 9:r=e.sent,a=r.reduce((function(e,t,r){var a=n[r].id;return Object(M.a)({},e,Object(te.a)({},a,t))}),{}),S(n),A(a),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),console.warn(e.t0.message);case 18:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(){return e.apply(this,arguments)}}();e(),t(),n()}),[m]),Object(a.useEffect)((function(){if(d&&E&&E.length){var e=o.current;if(e){var t=new re.a.Chart({el:e,pixelRatio:window.devicePixelRatio}),n=E.map((function(e){return{date:Object(ae.a)(e.date),price:e.c}}));t.source(n,{date:{type:"timeCat",mask:"HH:mm",values:n.slice(-96).map((function(e){return e.date}))},price:{formatter:function(e){return"".concat(e.toFixed(2)," ").concat(R(d.price.currency))}}}),t.tooltip({showCrosshairs:!0,showItemMarker:!1,background:{radius:2,fill:"#1890FF"},nameStyle:{fill:"#fff"},onShow:function(e){var t=e.items;t[0].name=t[0].title}}),t.scrollBar({mode:"x",xStyle:{offsetY:-5}}),t.area().position("date*price").shape("smooth"),t.line().position("date*price").shape("smooth"),t.interaction("pan"),t.render()}}}),[o,E,d]);var I=function(){le()({title:"Do you want to delete ".concat((null===d||void 0===d?void 0:d.symbol.showName)||i.ticker,"?"),icon:c.a.createElement(ie.a,null),centered:!0,okButtonProps:{type:"primary",danger:!0},onOk:function(){s(pe(i.ticker)),e.push("/")},onCancel:function(){}})},D=function(){s(me(i.ticker)),e.push("/")},P=function(e){if(!e.image)return c.a.createElement(be.a,{name:e.nickname,color:"#1890FF",size:"32",round:!0});var t="https://api-invest-gw.tinkoff.ru/social/file/v1/cache/profile/avatar/".concat(e.image,"?size=small");return c.a.createElement(N.a,{src:t,alt:e.nickname})},_=function(){if(j)return j.map((function(e){return c.a.createElement(ve.a,{className:"comment",key:e.id,author:e.nickname,avatar:P(e),content:c.a.createElement(ge.a,{text:e.text.replace(/\{\$(.*?)\}/g,"$1")}),datetime:Object(ce.a)(Object(se.a)(e.inserted),{addSuffix:!0}),actions:[c.a.createElement("div",{className:"comment-likes"},c.a.createElement(he.a,{className:"like-icon"}),e.likesCount)]},function(e){var t=null===T||void 0===T?void 0:T[e.id];if(t)return t.map((function(e){return c.a.createElement(ve.a,{className:"comment",key:e.id,author:e.nickname,avatar:P(e),content:c.a.createElement(ge.a,{text:e.text.replace(/\{(.*?)\}/g,"$1")}),datetime:Object(ce.a)(Object(se.a)(e.inserted),{addSuffix:!0}),actions:[c.a.createElement("div",{className:"comment-likes"},c.a.createElement(he.a,{className:"like-icon"}),e.likesCount)]})}))}(e))}))};return c.a.createElement(y,{title:null===d||void 0===d?void 0:d.symbol.showName,subtitle:null===d||void 0===d?void 0:d.symbol.ticker},c.a.createElement("div",{className:"stock-details-view"},c.a.createElement("div",{className:"details-container"},E&&d&&j?c.a.createElement("div",{className:"details"},d&&E&&E.length?c.a.createElement("canvas",{className:"chart-canvas",ref:o}):c.a.createElement(de.a,{image:de.a.PRESENTED_IMAGE_SIMPLE}),c.a.createElement("div",{className:"details-price"},function(){if(d&&E&&E.length){var e=E[E.length-1].c,t=R(d.price.currency);return"".concat(e," ").concat(t)}}()),c.a.createElement("div",{className:"details-posts"},_())):c.a.createElement("div",{className:"spin-container"},c.a.createElement(ke.a,null))),r.tickers.tickers.includes(i.ticker)?c.a.createElement(X,{type:"primary",danger:!0,icon:c.a.createElement(oe.a,null),block:!0,onClick:I},"Remove"):c.a.createElement(X,{type:"primary",icon:c.a.createElement(J.a,null),block:!0,onClick:D},"Add")))}n(618);var ye=n(636),je=n(645),Se=new w;function xe(){var e=Object(V.f)(),t=Object(a.useState)(),n=Object(f.a)(t,2),r=n[0],s=n[1],i=Object(a.useState)(),o=Object(f.a)(i,2),m=o[0],p=o[1],v=function(e,t){var n=Object(a.useState)(e),r=Object(f.a)(n,2),c=r[0],s=r[1];return Object(a.useEffect)((function(){var n=setTimeout((function(){s(e)}),t);return function(){clearTimeout(n)}}),[e,t]),c}(r,200);Object(a.useEffect)((function(){return function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Se.searchStocks(v);case 3:t=e.sent,p(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.warn(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}()(),function(){p(void 0)}}),[v]);return c.a.createElement(y,{title:"Add new stock"},c.a.createElement("div",{className:"add-stock-view"},c.a.createElement("div",{className:"search-container"},c.a.createElement(ye.a,{size:"large",placeholder:"Enter stock ticker or name",value:r,onChange:function(e){return s(e.currentTarget.value)},prefix:c.a.createElement(je.a,null)})),c.a.createElement("div",{className:"stocks-list-container"},c.a.createElement(A,{stocks:m,onSelect:function(t){e.push("/stock-details/".concat(t.symbol.ticker))}}))))}function Ne(){return c.a.createElement($.a,{basename:"/stocks-view-app"},c.a.createElement("div",{className:"stocks-view-app"},c.a.createElement(V.c,null,c.a.createElement(V.a,{exact:!0,path:"/",component:ee}),c.a.createElement(V.a,{path:"/stock-details/:ticker",component:Oe}),c.a.createElement(V.a,{path:"/add-stock",component:xe}))))}!function(){try{var e=localStorage.getItem("tickers");if(!e)throw new Error;var t=JSON.parse(e);W.dispatch(fe(t))}catch(n){}}();var Ce=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Te(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(623),n(624);i.a.render(c.a.createElement(L.a,{store:W},c.a.createElement(Ne,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/stocks-view-app",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/stocks-view-app","/service-worker.js");Ce?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Te(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Te(t,e)}))}}({})}},[[340,1,2]]]);
//# sourceMappingURL=main.f9d96f75.chunk.js.map