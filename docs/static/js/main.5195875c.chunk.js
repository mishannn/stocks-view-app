(this["webpackJsonpstocks-view"]=this["webpackJsonpstocks-view"]||[]).push([[0],{239:function(e,t,n){e.exports=n(499)},244:function(e,t,n){},246:function(e,t,n){},263:function(e,t,n){},297:function(e,t,n){},319:function(e,t,n){},342:function(e,t,n){},484:function(e,t,n){},497:function(e,t,n){},499:function(e,t,n){"use strict";n.r(t);var r,a=n(0),c=n.n(a),s=n(6),i=n.n(s),o=(n(244),n(11)),u=n.n(o),l=n(17),f=n(20),v=(n(246),n(51)),p=n(75),m=n(209),d=n.n(m),k=n(506),b=n(505);!function(e){e.GetStocks="stocks/list",e.GetStock="stocks/get",e.GetCandles="symbols/candles"}(r||(r={}));var h=function(){function e(){Object(v.a)(this,e),this.client=void 0,this.client=d.a.create({baseURL:"https://api.tinkoff.ru/trading"})}return Object(p.a)(e,[{key:"getStocks",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={tickers:t,country:"All",orderType:"Desc",sortType:"ByEarnings"},t&&(n.tickers=t),e.next=4,this.requestMethod(r.GetStocks,n);case 4:return a=e.sent,e.abrupt("return",a.values);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchStocks",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,c,s=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:20,a={country:"All",orderType:"Desc",sortType:"ByEarnings",start:0,end:n},t&&(a.filter=t),e.next=5,this.requestMethod(r.GetStocks,a);case 5:return c=e.sent,e.abrupt("return",c.values);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getStock",value:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.requestMethod(r.GetStock,{ticker:t}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCandles",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Date,a=Object(k.a)(n,1),e.next=4,this.requestMethod(r.GetCandles,{from:Object(b.a)(a),to:Object(b.a)(n),resolution:5,ticker:t});case 4:return c=e.sent,e.abrupt("return",c.candles);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestMethod",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(t,n);case 2:if(r=e.sent,!("code"in(a=r.data.payload))||!("message"in a)){e.next=6;break}throw new Error(a.message);case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),E=n(502);n(263);function g(e){var t=c.a.createElement("div",{className:"title-skeleton"});return c.a.createElement("div",{className:"main-layout"},c.a.createElement(E.a,{className:"header",onBack:e.onBack,title:e.title||t,subTitle:e.subtitle,extra:e.extra}),c.a.createElement("div",{className:"body"},e.children))}var w=function(e){return{type:"SET_STOCKS",stocks:e}},y=n(66),O=n(503),j=n(215),S=n(507),x=n(508),N=(n(297),function(e){var t={USD:"$",RUB:"\u20bd"}[e];return t||e});function C(e){var t=function(e){var t=["stock-earnings"];return 0===e.earnings.relative||(e.earnings.relative>0?t.push("positive"):t.push("negative")),t},n=function(e){var t=e.symbol.logoName.replace(".png","x160.png");return"https://static.tinkoff.ru/brands/traiding/".concat(t)},r=function(n){return e.manage?c.a.createElement("div",{className:"delete-button-container"},c.a.createElement(y.a,{type:"primary",danger:!0,onClick:function(){var t;return null===(t=e.onDelete)||void 0===t?void 0:t.call(e,n)}},"Delete")):c.a.createElement("div",{className:"price-container"},c.a.createElement("div",{className:"stock-price"},function(e){var t=e.price.value.toFixed(2),n=N(e.price.currency);return"".concat(t," ").concat(n)}(n)),c.a.createElement("div",{className:t(n).join(" ")},function(e){if(0!==e.earnings.relative)return e.earnings.relative>0?c.a.createElement(S.a,{className:"stock-earnings-caret"}):c.a.createElement(x.a,{className:"stock-earnings-caret"})}(n),function(e){var t=e.earnings.absolute.value.toFixed(2),n=N(e.earnings.absolute.currency),r=Math.abs(100*e.earnings.relative).toFixed(2);return"".concat(t," ").concat(n," (").concat(r,"%)")}(n)))};return c.a.createElement(O.b,{className:"stocks-list",loading:!e.stocks,dataSource:e.stocks||[],renderItem:function(t){return c.a.createElement(O.b.Item,{className:["item",t.symbol.isin].join(" "),key:t.symbol.isin,onClick:function(){return function(t){var n;null===(n=e.onSelect)||void 0===n||n.call(e,t)}(t)}},c.a.createElement(O.b.Item.Meta,{avatar:c.a.createElement(j.a,{src:n(t)}),title:t.symbol.showName,description:t.symbol.ticker}),c.a.createElement("div",{className:"content"},r(t)))}})}var T=n(10),A=n(37),R=function(e,t){var n=e.stocks?e.stocks:[];return n.find((function(e){return e.symbol.isin===t.stock.symbol.isin}))?e:Object(A.a)({},e,{stocks:[].concat(Object(T.a)(n),[t.stock])})},I=function(e,t){var n=e.stocks?e.stocks:[];return n.find((function(e){return e.symbol.isin===t.stock.symbol.isin}))?Object(A.a)({},e,{stocks:n.filter((function(e){return e!==t.stock}))}):e},D={stocks:void 0},M=function(e,t){if(e.tickers.includes(t.ticker))return e;var n=[].concat(Object(T.a)(e.tickers),[t.ticker]);return localStorage.setItem("tickers",JSON.stringify(n)),Object(A.a)({},e,{tickers:n})},K=function(e,t){if(!e.tickers.includes(t.ticker))return e;var n=e.tickers.filter((function(e){return e!==t.ticker}));return localStorage.setItem("tickers",JSON.stringify(n)),Object(A.a)({},e,{tickers:n})},_={tickers:["V","ADBE","AAPL","INTC","FB","AMD","GOOGL","GOOG","NVDA","MSFT","MA"]},B=n(90),G=n(91),F=Object(B.b)({stocks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_STOCKS":return Object(A.a)({},e,{stocks:t.stocks});case"ADD_STOCK":return R(e,t);case"REMOVE_STOCK":return I(e,t);case"CLEAR_STOCKS":return Object(A.a)({},e,{stocks:void 0});default:return e}},tickers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TICKERS":return localStorage.setItem("tickers",JSON.stringify(t.tickers)),Object(A.a)({},e,{tickers:t.tickers});case"ADD_TICKER":return M(e,t);case"REMOVE_TICKER":return K(e,t);case"CLEAR_TICKERS":return localStorage.setItem("tickers","[]"),Object(A.a)({},e,{tickers:[]});default:return e}}}),W=Object(B.c)(F),L=function(){return[Object(G.c)((function(e){return e})),Object(G.b)()]},J=n(509),U=n(13),q=n(50),P=n(225),V=n.n(P),H=n(107),$=n.n(H);n(319);function z(e){return c.a.createElement($.a,Object.assign({className:"bottom-button"},e),e.children)}var Y=new h;function Q(){var e=Object(U.f)(),t=L(),n=Object(f.a)(t,2),r=n[0],s=n[1];Object(a.useEffect)((function(){var e=function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y.getStocks(r.tickers.tickers);case 3:t=e.sent,s(w(t)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.warn(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e();var t=!1;return V()(function(){var n=Object(l.a)(u.a.mark((function n(r,a){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=3;break}return a(),n.abrupt("return");case 3:return n.abrupt("return",e());case 4:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),5e3),function(){t=!0}}),[s,r.tickers.tickers]);return c.a.createElement(g,{title:"Stocks"},c.a.createElement("div",{className:"main-view"},c.a.createElement("div",{className:"stock-list-container"},c.a.createElement(C,{stocks:r.stocks.stocks,onSelect:function(t){e.push("/stock-details/".concat(t.symbol.ticker))}})),c.a.createElement(q.b,{to:"/add-stock"},c.a.createElement(z,{type:"primary",icon:c.a.createElement(J.a,null),block:!0},"Add stock"))))}n(342);var X=n(227),Z=n.n(X),ee=n(501),te=n(510),ne=n(511),re=n(152),ae=n.n(re),ce=function(e){return{type:"SET_TICKERS",tickers:e}},se=function(e){return{type:"ADD_TICKER",ticker:e}},ie=function(e){return{type:"REMOVE_TICKER",ticker:e}},oe=n(222),ue=new h;function le(){var e=Object(U.f)(),t=L(),n=Object(f.a)(t,2),r=n[0],s=n[1],i=Object(U.h)(),o=Object(a.useRef)(),v=Object(a.useState)(),p=Object(f.a)(v,2),m=p[0],d=p[1],k=Object(a.useState)(),b=Object(f.a)(k,2),h=b[0],E=b[1];Object(a.useEffect)((function(){o.current=i.ticker})),Object(a.useEffect)((function(){var e=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.current){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,ue.getStock(t);case 6:n=e.sent,d(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.warn(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.current){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,ue.getCandles(t);case 6:n=e.sent,E(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.warn(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}();e(),t()}),[o]),Object(a.useEffect)((function(){if(h&&m){var e=new Z.a.Chart({id:"chart",pixelRatio:window.devicePixelRatio}),t=h.map((function(e){return{date:Object(ee.a)(e.date),price:e.c}}));e.source(t,{date:{type:"timeCat",mask:"HH:mm",values:t.slice(-96).map((function(e){return e.date}))},price:{formatter:function(e){return"".concat(e.toFixed(2)," ").concat(N(m.price.currency))}}}),e.tooltip({showCrosshairs:!0,showItemMarker:!1,background:{radius:2,fill:"#1890FF"},nameStyle:{fill:"#fff"},onShow:function(e){var t=e.items;t[0].name=t[0].title}}),e.scrollBar({mode:"x",xStyle:{offsetY:-5}}),e.area().position("date*price").shape("smooth"),e.line().position("date*price").shape("smooth"),e.interaction("pan"),e.render()}}),[h,m]);var w=function(){ae()({title:"Do you want to delete ".concat((null===m||void 0===m?void 0:m.symbol.showName)||i.ticker,"?"),icon:c.a.createElement(te.a,null),centered:!0,okButtonProps:{type:"primary",danger:!0},onOk:function(){s(ie(i.ticker)),e.push("/")},onCancel:function(){}})},y=function(){s(se(i.ticker)),e.push("/")};return c.a.createElement(g,{title:null===m||void 0===m?void 0:m.symbol.showName,subtitle:null===m||void 0===m?void 0:m.symbol.ticker},c.a.createElement("div",{className:"stock-details-view"},c.a.createElement("div",{className:"details-container"},h&&m?c.a.createElement("div",{className:"details"},c.a.createElement("canvas",{className:"chart-canvas",id:"chart"}),c.a.createElement("div",{className:"details-price"},h[h.length-1].c," ",N(m.price.currency))):c.a.createElement("div",{className:"spin-container"},c.a.createElement(oe.a,null))),r.tickers.tickers.includes(i.ticker)?c.a.createElement(z,{type:"primary",danger:!0,icon:c.a.createElement(ne.a,null),block:!0,onClick:w},"Remove"):c.a.createElement(z,{type:"primary",icon:c.a.createElement(J.a,null),block:!0,onClick:y},"Add")))}n(484);var fe=n(504),ve=n(512),pe=new h;function me(){var e=Object(U.f)(),t=Object(a.useState)(),n=Object(f.a)(t,2),r=n[0],s=n[1],i=Object(a.useState)(),o=Object(f.a)(i,2),v=o[0],p=o[1],m=function(e,t){var n=Object(a.useState)(e),r=Object(f.a)(n,2),c=r[0],s=r[1];return Object(a.useEffect)((function(){var n=setTimeout((function(){s(e)}),t);return function(){clearTimeout(n)}}),[e,t]),c}(r,200),d=L();Object(f.a)(d,2)[1];Object(a.useEffect)((function(){return function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,pe.searchStocks(m);case 3:t=e.sent,p(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.warn(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}()(),function(){p(void 0)}}),[m]);return c.a.createElement(g,{title:"Add new stock"},c.a.createElement("div",{className:"add-stock-view"},c.a.createElement("div",{className:"search-container"},c.a.createElement(fe.a,{size:"large",placeholder:"Enter stock ticker or name",value:r,onChange:function(e){return s(e.currentTarget.value)},prefix:c.a.createElement(ve.a,null)})),c.a.createElement("div",{className:"stocks-list-container"},c.a.createElement(C,{stocks:v,onSelect:function(t){e.push("/stock-details/".concat(t.symbol.ticker))}}))))}var de=n(231);function ke(e){return Object(de.a)(e,{stiffness:330,damping:22})}ke(0),ke(.8),ke(1),ke(1);function be(){return c.a.createElement(q.a,{basename:"/stocks-view-app"},c.a.createElement("div",{className:"stocks-view-app"},c.a.createElement(U.c,null,c.a.createElement(U.a,{exact:!0,path:"/",component:Q}),c.a.createElement(U.a,{path:"/stock-details/:ticker",component:le}),c.a.createElement(U.a,{path:"/add-stock",component:me}))))}!function(){try{var e=localStorage.getItem("tickers");if(!e)throw new Error;var t=JSON.parse(e);W.dispatch(ce(t))}catch(n){}}();var he=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ee(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(496),n(497);i.a.render(c.a.createElement(G.a,{store:W},c.a.createElement(be,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/stocks-view-app",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/stocks-view-app","/service-worker.js");he?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ee(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Ee(t,e)}))}}({})}},[[239,1,2]]]);
//# sourceMappingURL=main.5195875c.chunk.js.map